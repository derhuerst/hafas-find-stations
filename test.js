'use strict'

const createHafas = require('hafas-client')
const vbbProfile = require('hafas-client/p/vbb')
const {ifError, deepStrictEqual} = require('assert')
const findStations = require('.')

const hafas = createHafas(vbbProfile, 'hafas-find-stations example')

const bbox = {
	north: 52.528,
	west: 13.38,
	south: 52.5,
	east: 13.43
}

const expected = [
	'900000012101', '900000012102', '900000012104', '900000012151',
	'900000012153', '900000012154', '900000012155', '900000012156',
	'900000012157', '900000012158', '900000012161', '900000013101',
	'900000013104', '900000013151', '900000013152', '900000014103',
	'900000014105', '900000014107', '900000014151', '900000014152',
	'900000014156', '900000100001', '900000100002', '900000100003',
	'900000100004', '900000100005', '900000100007', '900000100008',
	'900000100010', '900000100011', '900000100012', '900000100013',
	'900000100014', '900000100015', '900000100017', '900000100018',
	'900000100019', '900000100024', '900000100025', '900000100026',
	'900000100027', '900000100030', '900000100031', '900000100032',
	'900000100037', '900000100038', '900000100040', '900000100045',
	'900000100047', '900000100051', '900000100080', '900000100506',
	'900000100508', '900000100509', '900000100512', '900000100513',
	'900000100514', '900000100515', '900000100516', '900000100518',
	'900000100519', '900000100520', '900000100521', '900000100523',
	'900000100526', '900000100527', '900000100528', '900000100530',
	'900000100531', '900000100535', '900000100537', '900000100540',
	'900000100541', '900000100543', '900000100544', '900000100546',
	'900000100559', '900000100560', '900000100701', '900000100703',
	'900000100704', '900000100705', '900000100707', '900000100708',
	'900000100711', '900000100712', '900000100719', '900000100726',
	'900000100819', '900000110022', '900000120510', '900000120511'
]

process.exitCode = 1
const collected = []

findStations(hafas, bbox, {concurrency: 1}, (err, station) => {
	ifError(err)

	if (station) collected.push(station.id)
	else if (station === null) {
		deepStrictEqual(collected.sort(), expected.sort())

		process.exitCode = 0
		console.info('tests passed ✔︎')
	}
})
.catch(ifError)
